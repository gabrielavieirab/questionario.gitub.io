<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quem é você?</title>
<style>
  :root{
    --bg:#ffffff; --ink:#111827; --muted:#6b7280;
    --panel:#ffffff; --border:#e5e7eb;
    --primary:#3b1a66;       /* roxo escuro */
    --emerald:#065f46;       /* verde esmeralda escuro */
    --emerald-bright:#10b981;
    --ok:#16a34a; --err:#dc2626;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial,sans-serif}
  header{padding:22px 16px 12px;border-bottom:2px solid var(--primary);background:#fafafa}
  header h1{font-size:24px;margin:0 0 6px;color:var(--primary)}
  header p{margin:0 0 8px;color:var(--muted);font-size:14px}

  main{max-width:1000px;margin:0 auto;padding:16px}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:14px 0 6px}
  @media (max-width:640px){.grid2{grid-template-columns:1fr}}
  .field{display:flex;flex-direction:column;gap:6px}
  .field label{font-size:13px;color:var(--muted)}
  .field input{border:1px solid var(--border);border-radius:12px;padding:12px;background:#fff}

  .linha{border:1px solid var(--border);border-radius:14px;padding:14px;margin:14px 0;background:var(--panel)}
  .linha[data-valid="true"]{border-color:var(--emerald-bright)}
  .linha[data-valid="false"]{border-color:var(--err)}
  .linha .top{display:flex;align-items:center;gap:10px;margin-bottom:12px;justify-content:space-between}
  .left-top{display:flex;align-items:center;gap:10px}
  .badge{font-size:12px;color:#fff;background:var(--primary);border-radius:999px;padding:6px 10px;min-width:30px;text-align:center}
  .help{font-size:13px;color:var(--muted)}
  .btn-clear{
    border:1px solid var(--primary); background:#fff; color:var(--primary);
    border-radius:999px; padding:6px 10px; font-size:12px; cursor:pointer;
  }
  .btn-clear:active{transform:translateY(1px)}

  .lista{display:grid;grid-template-columns:minmax(0,1fr) auto;row-gap:10px;column-gap:12px;align-items:center}
  .item{display:contents}
  .texto{line-height:1.35}
  select{appearance:none;background:#fff;border:1px solid var(--border);border-radius:10px;padding:8px 10px;min-width:82px}
  select:invalid{color:#9ca3af}

  .sum{margin-top:10px;font-size:12px;color:var(--muted)}
  .sum.ok{color:var(--emerald)} .sum.err{color:var(--err)}

  .footer-actions{display:flex;gap:12px;align-items:center;justify-content:flex-end;
    padding:16px;border-top:1px solid var(--border);margin-top:12px;flex-wrap:wrap}
  button{border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
  .btn-primary{background:var(--primary);color:#fff}
  .btn-primary:disabled{opacity:.5;cursor:not-allowed}

  .alert{display:none;margin:10px 0 0;color:#fff;background:var(--err);
    padding:12px;border-radius:10px;font-size:14px}
  .okmsg{display:none;margin:10px 0 0;color:var(--emerald);background:#e8fff5;
    padding:12px;border-radius:10px;font-size:14px;border:1px solid #bbf7d0}

  .result-box{display:none;margin-top:14px;background:#f9fafb;border:1px solid var(--border);
    border-radius:12px;padding:14px}
  .result-box h3{margin:0 0 6px;font-size:18px;color:var(--emerald)}
  .result-box .subtitle{margin:0 0 8px;color:var(--muted);font-size:13px}
  .ranking{margin:8px 0 0;padding-left:18px}
  .ranking li{margin:4px 0}
  @media (hover:none){select{min-height:44px}}
</style>
<!-- EmailJS opcional -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
  /* Configure se quiser envio automático via EmailJS (emailjs.com) */
  const EMAILJS_PUBLIC_KEY = "COLOQUE_SUA_PUBLIC_KEY_AQUI";
  const EMAILJS_SERVICE_ID = "COLOQUE_SEU_SERVICE_ID_AQUI";
  const EMAILJS_TEMPLATE_ID = "COLOQUE_SEU_TEMPLATE_ID_AQUI";
  if (typeof emailjs !== "undefined" && EMAILJS_PUBLIC_KEY.indexOf("PUBLIC_KEY") === -1) {
    emailjs.init(EMAILJS_PUBLIC_KEY);
  }
</script>
</head>
<body>
  <header>
    <h1>Quem é você?</h1>
    <p><strong>Como funciona a numeração:</strong> para cada linha de características, assinale <strong>“4”</strong> para o comportamento <strong>mais presente</strong> em você; <strong>“3”</strong> para um pouco menos presente; <strong>“2”</strong> para o menos presente ainda; e <strong>“1”</strong> para o comportamento <strong>muito menos presente</strong> em você. Não escolha o que gostaria de ser, mas o que realmente é.</p>
  </header>

  <main>
    <form id="formQuiz" novalidate>
      <!-- Identificação -->
      <div class="grid2" aria-label="Identificação">
        <div class="field">
          <label for="nome">Nome completo</label>
          <input id="nome" name="nome" type="text" placeholder="Digite seu nome" required />
        </div>
        <div class="field">
          <label for="email">E-mail</label>
          <input id="email" name="email" type="email" placeholder="seu@email.com" required />
        </div>
      </div>

      <!-- ======== 8 CONJUNTOS ======== -->
      <!-- 1 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 1">
        <div class="top">
          <div class="left-top">
            <span class="badge">1</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Confiante em si"><div class="texto">Confiante em si</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Otimista"><div class="texto">Otimista</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Intencional"><div class="texto">Intencional</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Contido"><div class="texto">Contido</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 2 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 2">
        <div class="top">
          <div class="left-top">
            <span class="badge">2</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Aventureiro"><div class="texto">Aventureiro</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Entusiasmado"><div class="texto">Entusiasmado</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Previsível"><div class="texto">Previsível</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Lógico"><div class="texto">Lógico</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 3 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 3">
        <div class="top">
          <div class="left-top">
            <span class="badge">3</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Desafiador"><div class="texto">Desafiador</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Impulsivo"><div class="texto">Impulsivo</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Equilibrado"><div class="texto">Equilibrado</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Preciso"><div class="texto">Preciso</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 4 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 4">
        <div class="top">
          <div class="left-top">
            <span class="badge">4</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Incansável"><div class="texto">Incansável</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Emotivo"><div class="texto">Emotivo</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Protetor"><div class="texto">Protetor</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Contestador"><div class="texto">Contestador</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 5 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 5">
        <div class="top">
          <div class="left-top">
            <span class="badge">5</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Competitivo"><div class="texto">Competitivo</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Persuasivo"><div class="texto">Persuasivo</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Acomodado"><div class="texto">Acomodado</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Curioso"><div class="texto">Curioso</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 6 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 6">
        <div class="top">
          <div class="left-top">
            <span class="badge">6</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Assertivo"><div class="texto">Assertivo</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Falador"><div class="texto">Falador</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Modesto"><div class="texto">Modesto</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Educado"><div class="texto">Educado</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 7 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 7">
        <div class="top">
          <div class="left-top">
            <span class="badge">7</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Experimentador"><div class="texto">Experimentador</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Sedutor"><div class="texto">Sedutor</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Fácil de conviver"><div class="texto">Fácil de conviver</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Consistente"><div class="texto">Consistente</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <!-- 8 -->
      <section class="linha" data-valid="false" aria-label="Conjunto 8">
        <div class="top">
          <div class="left-top">
            <span class="badge">8</span>
            <span class="help">Numere de 1 a 4, sem repetir, os comportamentos abaixo.</span>
          </div>
          <button type="button" class="btn-clear">Limpar respostas</button>
        </div>
        <div class="lista">
          <div class="item" data-profile="Dominante"   data-trait="Rigoroso"><div class="texto">Rigoroso</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Influente"   data-trait="Sensível"><div class="texto">Sensível</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Estável"     data-trait="Sincero"><div class="texto">Sincero</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
          <div class="item" data-profile="Analítico"   data-trait="Perfeccionista"><div class="texto">Perfeccionista</div><select required><option value="" disabled selected>—</option><option>4</option><option>3</option><option>2</option><option>1</option></select></div>
        </div>
        <div class="sum">Soma: 0 / 10</div>
      </section>

      <div class="footer-actions">
        <button class="btn-primary" id="btnEnviar" type="submit" disabled>Finalizar</button>
      </div>

      <div class="alert" id="alerta"></div>
      <div class="okmsg" id="okmsg">Respostas registradas. Veja abaixo o resultado.</div>

      <div class="result-box" id="resultBox">
        <h3>Resultado do seu perfil — Dominante, Influente, Estável e Analítico</h3>
        <p class="subtitle">Percentuais do mais presente para o menos presente</p>
        <ol class="ranking" id="ranking"></ol>
      </div>
    </form>
  </main>

<script>
(function(){
  const form = document.getElementById('formQuiz');
  const linhas = [...document.querySelectorAll('.linha')];
  const btnEnviar = document.getElementById('btnEnviar');
  const alerta = document.getElementById('alerta');
  const okmsg  = document.getElementById('okmsg');
  const resultBox  = document.getElementById('resultBox');
  const rankingEl  = document.getElementById('ranking');

  // Embaralhar alternativas em cada conjunto
  function shuffle(nodes){
    const arr = Array.from(nodes);
    for(let i = arr.length - 1; i > 0; i--){
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }
  linhas.forEach(ln => {
    const lista = ln.querySelector('.lista');
    const itens = [...ln.querySelectorAll('.item')];
    shuffle(itens).forEach(it => lista.appendChild(it));
  });

  // Validação por conjunto: 1,2,3,4 sem repetir (soma=10)
  linhas.forEach((ln) => {
    const selects = [...ln.querySelectorAll('select')];
    const sumEl   = ln.querySelector('.sum');

    function updateState(){
      const values = selects.map(s => s.value).filter(Boolean);
      selects.forEach(s => {
        const current = s.value;
        [...s.options].forEach(opt => {
          if(!opt.value) return;
          const used = values.includes(opt.value);
          opt.disabled = used && opt.value !== current;
        });
      });
      const sum = values.map(Number).reduce((a,b)=>a+b,0);
      sumEl.textContent = `Soma: ${sum} / 10`;
      const complete = values.length === 4;
      const valid    = complete && sum === 10 && new Set(values).size === 4;
      ln.dataset.valid = valid ? 'true' : 'false';
      sumEl.className = 'sum ' + (valid ? 'ok' : (complete ? 'err' : ''));
      validateForm();
    }
    selects.forEach(s => s.addEventListener('change', updateState));
    updateState();
  });

  function idOk(){
    const nome = document.getElementById('nome').value.trim();
    const email = document.getElementById('email').value.trim();
    const emailOk = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    return nome.length >= 3 && emailOk;
  }
  function validateForm(){
    const allValid = linhas.every(ln => ln.dataset.valid === 'true');
    btnEnviar.disabled = !(allValid && idOk());
    alerta.style.display = 'none';
    okmsg.style.display  = 'none';
  }
  form.addEventListener('input', validateForm);

  function readyToSend(){
    const invalids = linhas.filter(ln => ln.dataset.valid !== 'true');
    if(!idOk()){
      alerta.textContent = 'Preencha Nome e um E-mail válido.';
      alerta.style.display = 'block';
      window.scrollTo({top:0, behavior:'smooth'});
      return false;
    }
    if(invalids.length){
      alerta.textContent = 'Em cada conjunto use 1, 2, 3 e 4 (sem repetir). A soma precisa ser 10.';
      alerta.style.display = 'block';
      window.scrollTo({top:invalids[0].offsetTop - 24, behavior:'smooth'});
      return false;
    }
    return true;
  }

  // Botões "Limpar respostas" (um por conjunto)
  document.querySelectorAll('.linha .btn-clear').forEach((btn, idx) => {
    btn.addEventListener('click', () => {
      const ln = btn.closest('.linha');
      const selects = ln.querySelectorAll('select');
      selects.forEach(s => {
        s.value = "";
        // reabilita todas as opções
        [...s.options].forEach(opt => { if (opt.value) opt.disabled = false; });
        // dispara change para refazer o estado/validação
        s.dispatchEvent(new Event('change', {bubbles:true}));
      });
      const sumEl = ln.querySelector('.sum');
      if (sumEl) sumEl.textContent = 'Soma: 0 / 10';
      ln.dataset.valid = 'false';
      validateForm();
    });
  });

  // Percentuais por perfil com "maior resto" (fecha 100%)
  function calcularPercentuais(){
    const tot = {Dominante:0, Influente:0, Estável:0, Analítico:0};
    linhas.forEach(ln => {
      ln.querySelectorAll('select').forEach(sel => {
        const valor = Number(sel.value || 0);
        if (!valor) return;
        const perfil = sel.closest('.item').getAttribute('data-profile');
        tot[perfil] += valor;
      });
    });
    const totalGeral = 8 * 10; // 80 pts
    const tmp = Object.entries(tot).map(([perfil, pontos]) => {
      const pctReal = (pontos/totalGeral)*100;
      const inteiro = Math.floor(pctReal);
      const frac = pctReal - inteiro;
      return { perfil, inteiro, frac, final: inteiro };
    });
    const somaInt = tmp.reduce((s,x)=>s+x.inteiro,0);
    let faltando = 100 - somaInt;
    tmp.sort((a,b)=> b.frac - a.frac);
    for(let i=0;i<tmp.length && faltando>0;i++,faltando--){ tmp[i].final += 1; }
    return tmp.sort((a,b)=> b.final - a.final).map(x => ({perfil:x.perfil, pct:x.final}));
  }

  function mostrarRankingTela(lista){
    rankingEl.innerHTML = '';
    lista.forEach(({perfil, pct}) => {
      const li = document.createElement('li');
      li.textContent = `${perfil}: ${pct}%`;
      rankingEl.appendChild(li);
    });
  }

  function montarResumoApenasResultado(nome, email, ranking){
    const linhas = [];
    linhas.push(`Quem é você? — Resultado do perfil`);
    linhas.push(`Nome: ${nome}`);
    linhas.push(`E-mail do respondente: ${email}`);
    linhas.push('');
    linhas.push('Percentuais:');
    ranking.forEach(r => linhas.push(`• ${r.perfil}: ${r.pct}%`));
    return linhas.join('\n');
  }

  // Envio por e-mail (somente resultado)
  async function enviarEmailSomenteResultado(nome, email, ranking){
    const assunto = `Quem é você? – Resultado de ${nome}`;
    const corpo = montarResumoApenasResultado(nome, email, ranking);

    // EmailJS se configurado
    if (typeof emailjs !== "undefined" &&
        EMAILJS_PUBLIC_KEY.indexOf("PUBLIC_KEY") === -1 &&
        EMAILJS_SERVICE_ID.indexOf("SERVICE_ID") === -1 &&
        EMAILJS_TEMPLATE_ID.indexOf("TEMPLATE_ID") === -1) {
      try{
        await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, {
          to_email: "alessandra@consultarh.com.br",
          from_email: email,
          from_name: nome,
          subject: assunto,
          message: corpo
        });
        return true;
      }catch(e){
        console.warn('Falha no EmailJS, usando mailto:', e);
      }
    }

    // Fallback: mailto
    const mailto = `mailto:${encodeURIComponent("alessandra@consultarh.com.br")}`+
                   `?subject=${encodeURIComponent(assunto)}`+
                   `&body=${encodeURIComponent(corpo)}`;
    window.location.href = mailto;
    return true;
  }

  // Finalizar
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    if(!readyToSend()) return;

    const nome  = document.getElementById('nome').value.trim();
    const email = document.getElementById('email').value.trim();

    const ranking = calcularPercentuais();            // % que somam 100
    mostrarRankingTela(ranking);                      // mostra na tela
    resultBox.style.display = 'block';
    alerta.style.display = 'none';
    okmsg.style.display = 'block';
    resultBox.scrollIntoView({behavior:'smooth', block:'start'});

    await enviarEmailSomenteResultado(nome, email, ranking); // envia só o resultado
  });

  validateForm();
})();
</script>
</body>
</html>