<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Quem é você? | Questionário de Perfil</title>
<style>
  :root{
    --bg:#0f172a;
    --card:#111827;
    --muted:#94a3b8;
    --accent:#22d3ee;
    --accent-2:#38bdf8;
    --text:#e5e7eb;
    --good:#22c55e;
    --warn:#f59e0b;
    --bad:#ef4444;
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;
    background: radial-gradient(1200px 1200px at 100% -10%, #1e293b 0, #0b1220 50%, #050816 100%);
    color:var(--text);
    line-height:1.45;
  }
  .container{
    max-width:1100px;
    margin:auto;
    padding:24px;
  }
  header{
    display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
    margin-bottom:16px;
  }
  .title{
    font-size: clamp(22px, 4vw, 32px);
    font-weight: 800;
    letter-spacing:.2px;
    display:flex; align-items:center; gap:10px;
  }
  .badge{
    font-size:12px; padding:4px 8px; border:1px solid #334155; border-radius:999px; color:#cbd5e1
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border: 1px solid #1f2937;
    border-radius:16px;
    box-shadow: 0 7px 30px rgba(2,8,23,0.35);
  }
  .intro{padding:18px 20px; color:#cbd5e1; font-size:15px}
  .intro strong{color:#e2e8f0}
  .grid{
    overflow:auto;
  }
  table{
    width:100%;
    border-collapse:separate; border-spacing:0;
    min-width:850px;
  }
  thead th{
    position:sticky; top:0; z-index:3;
    background:#0b1220;
  }
  th, td{
    padding:10px 12px;
    border-bottom:1px solid #1f2937;
    text-align:left;
    vertical-align:middle;
  }
  thead th{
    font-size:12px; text-transform:uppercase; letter-spacing:.08em; color:#a5b4fc;
  }
  tbody tr:nth-child(even) td{ background: rgba(255,255,255,0.02); }
  tbody tr:hover td{ background: rgba(34,211,238,0.06); }
  .trait{color:#e2e8f0; font-weight:600}
  select{
    background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:8px; padding:8px 10px;
    width:80px; font-size:14px;
    outline:none;
  }
  select:focus{ border-color: var(--accent); box-shadow: 0 0 0 3px rgba(56,189,248,.25) }
  .sumcell{font-variant-numeric: tabular-nums; color:#cbd5e1}
  .sum-bad{color:var(--bad); font-weight:700}
  .sum-good{color:var(--good); font-weight:700}
  .actions{
    display:flex; flex-wrap:wrap; gap:10px; padding:16px; border-top:1px solid #1f2937
  }
  button{
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    color:#0b1220; border:none; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer;
  }
  button.secondary{
    background:#0b1220; color:#cbd5e1; border:1px solid #334155;
  }
  .results{
    margin-top:16px; padding:16px 18px 4px;
    display:grid; grid-template-columns:repeat(auto-fit, minmax(230px,1fr)); gap:14px;
  }
  .pill{
    padding:12px; border:1px solid #334155; border-radius:14px;
    background: linear-gradient(180deg, rgba(56,189,248,0.05), rgba(56,189,248,0.02));
  }
  .pill h4{margin:0 0 6px 0; font-size:15px}
  .bar{
    height:10px; border-radius:999px; background:#0b1220; border:1px solid #334155; overflow:hidden
  }
  .bar > span{
    display:block; height:100%;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    width:0%;
    transition: width .25s ease;
  }
  .foot{
    color:#94a3b8; font-size:12px; padding:12px 18px 18px;
  }
  .hint{color:#a5b4fc; font-weight:600}
  .error{color:var(--bad); font-weight:700}
  .ok{color:var(--good); font-weight:700}
  .nowrap{white-space:nowrap}
  .center{text-align:center}
</style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">Quem é você? <span class="badge">Questionário interativo</span></div>
      <div class="badge">Distribua 1, 2, 3 e 4 em cada linha. A soma precisa dar 10.</div>
    </header>

    <section class="card intro">
      <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin-bottom:8px">
        <label for="nome" style="font-weight:700; color:#e5e7eb">Nome do participante</label>
        <input id="nome" type="text" placeholder="Digite o nome..." 
               style="flex:1; min-width:260px; max-width:420px; background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:10px 12px; outline:none"
               />
      </div>
      <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap; margin:2px 0 10px">
        <label for="email" style="font-weight:700; color:#e5e7eb">E-mail</label>
        <input id="email" type="email" placeholder="Opcional" 
               style="flex:1; min-width:220px; max-width:320px; background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:10px 12px; outline:none"/>
        <label for="fone" style="font-weight:700; color:#e5e7eb">Telefone</label>
        <input id="fone" type="tel" placeholder="Opcional" 
               style="flex:1; min-width:160px; max-width:220px; background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:10px; padding:10px 12px; outline:none"/>
        
      </div>
      <p><strong>Como funciona:</strong> Em cada linha há 4 características. Atribua os números <strong>1</strong>, <strong>2</strong>, <strong>3</strong> e <strong>4</strong> (sem repetir) conforme o quanto cada traço está presente em você — <em>4 = mais presente</em>, <em>1 = menos presente</em>. A soma da linha deve ser 10.</p>
      <p>Ao final, vamos totalizar por coluna e mostrar seu perfil predominante: <strong>Diretivo</strong>, <strong>Interativo</strong>, <strong>Sociais</strong> ou <strong>Calculista</strong>.</p>
    </section>

    <section class="card grid" id="app"></section>

    <section class="card results" id="results" style="display:none"></section>
    <div class="foot" id="footnote" style="display:none">
      <p class="hint">Dica: compartilhe o link desta página com seus clientes. Eles podem preencher pelo celular e enviar o CSV de resultado pra você.</p>
    </div>
  </div>

<script>
const nomeInput = () => document.getElementById('nome');
document.addEventListener('input', (e)=>{
  if(e.target && e.target.id==='nome'){ localStorage.setItem('quizNome', e.target.value || ''); }
});
document.addEventListener('DOMContentLoaded', ()=>{
  const saved = localStorage.getItem('quizNome');
  if(saved !== null && document.getElementById('nome')){ document.getElementById('nome').value = saved; }
});

const rows = [
  ["Confiante em si","Otimista","Deliberado","Contido"],
  ["Aventureiro","Entusiasmado","Previsível","Lógico"],
  ["Desafiador","Impulsivo","Equilibrado","Preciso"],
  ["Incansável","Emotivo","Protetor","Contestador"],
  ["Competitivo","Persuasivo","Acomodado","Curioso"],
  ["Assertivo","Falador","Modesto","Educado"],
  ["Experimentador","Sedutor","Fácil de conviver","Consistente"],
  ["Rigoroso","Sensível","Sincero","Perfeccionista"]
];

const colHeaders = [
  { key: "diretivo",  title: "Direcionado → Diretivo" },
  { key: "interativo",title: "Influente → Interativo" },
  { key: "sociais",   title: "Estável → Sociais" },
  { key: "calculista",title: "Cuidadoso → Calculista" }
];

function buildTable(){
  const host = document.getElementById('app');
  const wrapper = document.createElement('div');
  wrapper.innerHTML = `
    <table>
      <thead>
        <tr>
          <th style="width:34%">Características</th>
          ${colHeaders.map(h=>`<th class="nowrap">${h.title}</th>`).join('')}
          <th class="center">Soma</th>
        </tr>
      </thead>
      <tbody>
        ${rows.map((r,ri)=>`
          <tr data-row="${ri}">
            <td class="trait">${r.join(" • ")}</td>
            ${[0,1,2,3].map(ci=>`
              <td>
                <select aria-label="Linha ${ri+1} coluna ${ci+1}" data-ri="${ri}" data-ci="${ci}">
                  <option value="">—</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                </select>
              </td>
            `).join('')}
            <td class="sumcell center">0</td>
          </tr>
        `).join('')}
      </tbody>
    </table>
    <div class="actions">
      <button id="btnCalc">Calcular resultado</button>
      <button id="btnReset" class="secondary">Limpar respostas</button>
      <button id="btnCSV" class="secondary" title="Baixa um .csv com as respostas e totais.">Exportar CSV</button>
      <button id="btnWA" class="secondary" title="Abre o WhatsApp já com o resumo para envio.">Enviar resultado no WhatsApp</button><span id="status" class="badge"></span>
    </div>
  `;
  host.appendChild(wrapper);

  host.addEventListener('change', (e)=>{
    if(e.target.tagName === 'SELECT'){
      const rowEl = e.target.closest('tr');
      updateRowSum(rowEl);
      saveToLocal();
    }
  });

  document.getElementById('btnCalc').addEventListener('click', calculate);
  document.getElementById('btnReset').addEventListener('click', resetAll);
  document.getElementById('btnCSV').addEventListener('click', exportCSV);

  // restore if available
  restoreFromLocal();
  // initial sums
  document.querySelectorAll('tbody tr').forEach(updateRowSum);
}

function updateRowSum(rowEl){
  const selects = [...rowEl.querySelectorAll('select')];
  const vals = selects.map(s => Number(s.value||0));
  const sum = vals.reduce((a,b)=>a+b,0);
  const cell = rowEl.querySelector('.sumcell');
  cell.textContent = sum;
  cell.classList.remove('sum-bad','sum-good');
  if(sum === 10 && isPermutation(vals)){
    cell.classList.add('sum-good');
    cell.title = 'OK: soma 10 e sem números repetidos';
  }else if(sum > 0){
    cell.classList.add('sum-bad');
    cell.title = 'Atenção: cada linha deve ter 1,2,3 e 4 — soma precisa ser 10';
  }else{
    cell.title='';
  }
}

function isPermutation(vals){
  const set = new Set(vals);
  if(vals.includes(0)) return false;
  if(set.size !== 4) return false;
  return [1,2,3,4].every(n=>set.has(n));
}

function validateAll(){
  let ok = true;
  document.querySelectorAll('tbody tr').forEach(tr => {
    const vals = [...tr.querySelectorAll('select')].map(s=>Number(s.value||0));
    const valid = (vals.reduce((a,b)=>a+b,0) === 10) && isPermutation(vals);
    if(!valid) ok = false;
  });
  return ok;
}

function calculate(){
  const status = document.getElementById('status');
  if(!validateAll()){
    status.innerHTML = '<span class="error">Corrija as linhas destacadas: use 1,2,3 e 4 (sem repetir) e some 10.</span>';
    document.getElementById('results').style.display='none';
    document.getElementById('footnote').style.display='none';
    return;
  }
  status.innerHTML = '<span class="ok">Tudo certo! Veja seu resultado abaixo.</span>';
  const nomeVal = (nomeInput() ? (nomeInput().value || '').trim() : '');
  if(nomeInput()){ localStorage.setItem('quizNome', nomeVal); }
  const totals = [0,0,0,0];
  document.querySelectorAll('tbody tr').forEach(tr => {
    tr.querySelectorAll('select').forEach((s,ci)=>{
      totals[ci]+= Number(s.value);
    });
  });
  const max = Math.max(...totals);
  renderResults(totals, max);
  saveToLocal();
}

function renderResults(totals, max){
  const root = document.getElementById('results');
  root.style.display='grid';
  root.innerHTML = `<div class="pill" style="grid-column:1/-1">
        <h4 style="margin:0">Participante</h4>
        <p style="margin:.3rem 0 0; color:#cbd5e1"><strong>${(nomeInput()? (nomeInput().value||'') : '') || '—'}</strong></p>
      </div>` + colHeaders.map((h,idx)=>{
    const pct = Math.round((totals[idx] / (rows.length*4)) * 100);
    const star = totals[idx]===max ? ' ⭐' : '';
    return `
      <div class="pill">
        <h4>${h.title.split('→')[1].trim()}<span>${star}</span></h4>
        <div class="bar" aria-hidden="true"><span style="width:${pct}%"></span></div>
        <p style="margin:.5rem 0 0; color:#cbd5e1">Total: <strong>${totals[idx]}</strong> (${pct}%)</p>
        <p style="margin:.35rem 0 0; color:#94a3b8; font-size:13px">${desc(h.key)}</p>
      </div>
    `;
  }).join('');
  document.getElementById('footnote').style.display='block';
}

function desc(key){
  const d = {
    diretivo: "Foco em resultados, rápido nas decisões, gosta de liderança e desafios. Pode soar impaciente.",
    interativo: "Comunicativo, influencia e motiva, valoriza relações e novidades. Atenção a seguir planos até o fim.",
    sociais: "Calmo, cooperativo e leal. Busca harmonia e estabilidade. Pode evitar conflitos necessários.",
    calculista: "Analítico, cuidadoso e preciso. Gosta de dados e qualidade. Pode demorar a decidir."
  };
  return d[key] || "";
}

function resetAll(){
  document.querySelectorAll('select').forEach(s=> s.value = '');
  document.querySelectorAll('tbody tr').forEach(updateRowSum);
  document.getElementById('results').style.display='none';
  document.getElementById('footnote').style.display='none';
  document.getElementById('status').textContent='';
  localStorage.removeItem('quizState');
  // keep the saved name
}

function exportCSV(){
  if(!validateAll()){
    alert("Antes, complete corretamente todas as linhas (1,2,3,4; soma 10).");
    return;
  }
  const rowsOut = [];
  rows.forEach((r,ri)=>{
    const vals = [...document.querySelectorAll(`tr[data-row="${ri}"] select`)].map(s=>s.value);
    rowsOut.push([(nomeInput()? (nomeInput().value||"") : ""), `Linha ${ri+1}`, ...r, ...vals]);
  });
  // Totais
  const totals = [0,0,0,0];
  document.querySelectorAll('tbody tr').forEach(tr => {
    tr.querySelectorAll('select').forEach((s,ci)=> totals[ci]+= Number(s.value) );
  });
  const header = ["Nome","#","Traço 1","Traço 2","Traço 3","Traço 4","Diretivo","Interativo","Sociais","Calculista"];
  const data = [header, ...rowsOut, [(nomeInput()? (nomeInput().value||"") : ""), "Totais","","","", "", ...totals]];
  const csv = data.map(r => r.map(v => `"${String(v).replace(/"/g,'""')}"`).join(",")).join("\n");
  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = "resultado_questionario.csv";
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(url);
}

function saveToLocal(){
  const state = [...document.querySelectorAll('tbody tr')].map(tr=>{
    return [...tr.querySelectorAll('select')].map(s=>s.value);
  });
  localStorage.setItem('quizState', JSON.stringify(state));
}
function restoreFromLocal(){
  const raw = localStorage.getItem('quizState');
  if(!raw) return;
  try{
    const state = JSON.parse(raw);
    state.forEach((rowVals,ri)=>{
      rowVals.forEach((v,ci)=>{
        const sel = document.querySelector(`tr[data-row="${ri}"] select[data-ci="${ci}"]`);
        if(sel) sel.value = v;
      });
    });
  }catch(e){}
}
buildTable();

// persist simple fields
['email','fone','zapdest'].forEach(id=>{
  const el = document.getElementById(id);
  if(el){
    const saved = localStorage.getItem('quiz_'+id);
    if(saved !== null) el.value = saved;
    el.addEventListener('input', ()=> localStorage.setItem('quiz_'+id, el.value || ''));
  }
});

// WhatsApp send
function getTotals(){
  const totals = [0,0,0,0];
  document.querySelectorAll('tbody tr').forEach(tr => {
    tr.querySelectorAll('select').forEach((s,ci)=> totals[ci]+= Number(s.value||0) );
  });
  return totals;
}
function buildResumo(){
  const nome = (nomeInput()? (nomeInput().value||'') : '');
  const email = (document.getElementById('email')?.value||'');
  const fone = (document.getElementById('fone')?.value||'');
  const totals = getTotals();
  const linhasOk = validateAll();
  const perfis = ["Diretivo","Interativo","Sociais","Calculista"];
  const max = Math.max(...totals);
  const top = perfis.filter((_,i)=> totals[i]===max).join(' / ') || '—';
  let txt = `Questionário: Quem é você?%0A`+
            `Nome: ${nome||'—'}%0A`+
            (email? `E-mail: ${email}%0A`:'')+
            (fone? `Telefone: ${fone}%0A`:'')+
            `---%0A`+
            perfis.map((p,i)=> `${p}: ${totals[i]}`).join('%0A')+
            `%0APerfil predominante: ${top}%0A`+
            (linhasOk? 'Soma/validação: OK':'Soma/validação: revisar linhas');
  return txt;
}

document.getElementById('btnWA').addEventListener('click', ()=>{
  if(!validateAll()){ if(!confirm('Existem linhas incompletas. Enviar mesmo assim?')) return; }
  const dest = "5561981650524";
  const base = `https://wa.me/${dest}`;
  const url = base + `?text=` + buildResumo();
  window.open(url, '_blank');
});

</script>
</body>
</html>
